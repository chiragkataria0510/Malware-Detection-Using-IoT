import React, { useContext, useEffect, useState } from "react";
import { useRouter } from 'next/router';
import { ResponsiveContainer } from "recharts";
import TempGauge from "../components/ui/LiveData/TempGauge";
import Typography from "@mui/material/Typography";
import Paper from "@mui/material/Paper";
import Grid from "@mui/material/Grid";
import Layout from "../Layout/Layout"
import { DataStore } from '../utils/DataStore';
import axios from 'axios'
import Image from 'next/image'
export default function LiveData({ }) {
  const router = useRouter();
  const { state } = useContext(DataStore);
  const { userInfo } = state;

  const [lastEntry79f9, setLastEntry79f9] = useState([])



  useEffect(() => {
    if (!userInfo) {
      router.push('/login');
    }

    async function fetch() {
      const { data } = await axios.get(`/api/lastEntries`);
      await setLastEntry79f9(data.lastEntry79f9);
  
      console.log('Latest Entries Fetched')
    }
    fetch();
  }, [userInfo, router]);



  setTimeout(function(){
    if (window !== undefined) {
      // browser code
      window.location.reload(1);
    }
 },  300000);


  return (
    <Layout>
      <Grid container>
        {/* 79f9 */}
        <Grid
          component={Paper}
          style={{ border: "2px solid #F23034", borderRadius: "1rem" }}
          className="p-0"
          item
          lg={5}
          md={5}
          sm={6}
          xs={12}
          spacing={2}
        >
          <ResponsiveContainer className="p-0" width="100%">
            <>
              <div
                className="p-1"
                style={{
                  backgroundColor: "#F23034",
                  borderRadius: "1rem",
                  color: "#fff",
                  textAlign: "center",
                }}
              >
                <h5>Malware Error</h5>
              </div>
              <Grid sx={{ p: 2 }} container spacing={2}>
                <Grid item xs={12}>
                  {lastEntry79f9.length > 0 ? (
                    <>
                      <div style={{ position: 'relative', left: '0rem' }}>
                        <TempGauge value={lastEntry79f9[0].malware_error} />
                      </div>
                      <Typography style={{left:"-1rem",top:"2rem"}} fontWeight={900} variant="h3" align="center" >Error:  {parseFloat(lastEntry79f9[0].malware_error).toFixed(2)} %</Typography>
                    </>) : (<>
                      <div style={{ position: 'relative', left: '0rem' }}>
                        <TempGauge value={18} />
                      </div>
                      <Typography fontWeight={800} variant="h3" align="center" >{`--`} %</Typography>
                    </>)}


                </Grid>
               
              </Grid>
            </>
          </ResponsiveContainer>
        </Grid>

        <Grid
          className="p-0"
          item
          lg={7}
          md={7}
          sm={6}
          xs={12}
          spacing={2}
        >
            <>
              <Image width={1000} height={600} src="/bug.png" alt="IGSCS Logo" />
            </>
        </Grid>
      </Grid>
    </Layout>
  );
}

